<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"/>
    <style type='text/css'>
      /*如果需要更改聊天按钮的样式可以在此处修改*/
      .embeddedServiceHelpButton .helpButton .uiButton {
        background-color: #62cfc5;
        font-family: "Arial", sans-serif;
      }
      .embeddedServiceHelpButton .helpButton .uiButton:focus {
        outline: 1px solid #62cfc5;
      }
      .embeddedServiceSidebarMinimizedDefaultUI.helpButton {
        /* display: none; */
      }
      .helpButton {
        /* display: none; */
      }
    </style>
  </head>
  <body>
    <!-- 聊天按钮，使用时可以用自定义的按钮覆盖 -->
    <input type="button" value="聊天按钮" onclick="chatBtnClick()" />
  </body>
  <script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
  <script type='text/javascript' src='https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js'></script>
  <script type='text/javascript'>
    //获取URL参数
    function GetRequest() {
      var url = location.search; //获取url中"?"符后的字串
      var theRequest = new Object();
      if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for(var i = 0; i < strs.length; i ++) {
          theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
        }
      }
      return theRequest;
    }
    var queryParams = GetRequest();
    if (queryParams.email) {
      queryParams.email = decodeURIComponent(queryParams.email)
    }
    var initESW = function(gslbBaseURL) {
      console.log(queryParams, 'queryParams') 
      embedded_svc.settings.displayHelpButton = true; //Or false
      embedded_svc.settings.language = queryParams.lan; //For example, enter 'en' or 'en-US' or 'fr'
      //设置聊天前聊天脚本的自定义字段
      embedded_svc.settings.extraPrechatFormDetails = [{
        "label": "PageUrl",
        "value":  window.location.href,
        "displayToAgent": true,
        "transcriptFields": ["PageUrl__c"]
      },
      {
        "label":"Prénom", 
        "transcriptFields": ["First_Name__c"]
      },
      {
        "label":"Nom", 
        "transcriptFields": ["Last_Name__c"]
      },
      // {
      //   "label":"Adresse e-mail", 
      //   "transcriptFields": ["Email__c"]
      // }
      // {
      //   "label":"Mobile", 
      //   "transcriptFields": ["Phone__c"]
      // }
      ];
            
      //设置聊天前联系人字段
      embedded_svc.settings.extraPrechatInfo = [{
        "entityName":"Contact",
        "saveToTranscript":"Contact",
        "showOnCreate":true,
        "entityFieldMaps":[
        {
          "doCreate":true,
          "doFind":false,
          "fieldName":"LastName",
          "isExactMatch":false,
          "label":"Nom",
        },
        {
          "doCreate":true,
          "doFind":false,
          "fieldName":"FirstName",
          "isExactMatch":false,
          "label":"Prénom",
        },
        // {
        //   "doCreate":true,
        //   "doFind":true,
        //   "fieldName":"ContactKey__c",
        //   "isExactMatch":true,
        //   "label":"Adresse e-mail",
        // }
        // {"doCreate":true,
        //  "doFind":false,
        //  "fieldName":"MobilePhone",
        //  "isExactMatch":false,
        //  "label":"Mobile"
        // }
          ],
      }];

      embedded_svc.settings.enabledFeatures = ['LiveAgent'];
      embedded_svc.settings.entryFeature = 'LiveAgent';
      embedded_svc.init(
        'https://anker--dev.my.salesforce.com',
        'https://dev-support-eufylife.cs73.force.com',
      gslbBaseURL,
        '00D6D0000008f1Q',
        'Eufylife_French_Embedded_Service_Deployment',
        {
          baseLiveAgentContentURL: 'https://c.la1-c1cs-ukb.salesforceliveagent.com/content',
          deploymentId: '5726D0000008OXU',
          buttonId: '5736D0000008Okt',
          baseLiveAgentURL: 'https://d.la1-c1cs-ukb.salesforceliveagent.com/chat',
          eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04I6D0000004CKfUAM_1785dcf9034',
          isOfflineSupportEnabled: false,
        }
      );
    };
    if (!window.embedded_svc) {
      var s = document.createElement('script');
      s.setAttribute('src', 'https://anker--dev.my.salesforce.com/embeddedservice/5.0/esw.min.js');
      s.onload = function() {
          initESW(null);
      };
      document.body.appendChild(s);
    } else {
      initESW('https://service.force.com');
    }
    //聊天按钮点击事件
    function chatBtnClick() {
      $('.helpButtonEnabled').trigger("click");
      $(".minimizedContainer").click();
    }
    $('.helpButtonEnabled').click(function(){
      setTimeout(() => {
      $('#FirstName').trigger("change");
      $('#FirstName').attr("value", '000099')
      // $('.LastName').val('7777');
      // $('.ContactKey__c').val('qwqw@qq.com');
      // $('.uiButton').trigger('click');
      console.log($('.showDockableContainer').html(), '====test1')
    }, 6000);
    })
    // setTimeout(() => {
    //   chatBtnClick()
    // }, 1000);
  </script>
</html>
