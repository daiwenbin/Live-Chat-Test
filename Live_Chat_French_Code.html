<html>
        <head>
            <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"/>
        </head>
        <body>
            <style type='text/css'>
                .embeddedServiceHelpButton .helpButton .uiButton {
                    background-color: #00a7e1;
                    font-family: "Arial", sans-serif;
                }
                .embeddedServiceHelpButton .helpButton .uiButton:focus {
                    outline: 1px solid #00a7e1;
                }
            </style>

            <script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
            <script type='text/javascript'>

                console.log("window.location.href: " + window.location.href);


                /*
                    获取URL中测参数
                */
                function getQueryVariable(variable) {
                   var query = window.location.search.substring(1);
                   var vars = query.split("&");
                   for (var i=0;i<vars.length;i++) {
                           var pair = vars[i].split("=");
                           if(pair[0] == variable){return pair[1];}
                   }
                   return(false);
                }

                // var productType = getQueryVariable("productType");

                // console.log("productType:" +productType);



                var initESW = function(gslbBaseURL) {
                    embedded_svc.settings.displayHelpButton = true; //或为假
                    embedded_svc.settings.language = 'en'; //例如，输入 'en' 或 'en-US'

                    embedded_svc.settings.defaultMinimizedText = 'Get Help'; //（默认设置为与专家聊天）
                    //embedded_svc.settings.disabledMinimizedText = '...'; //（默认设置为客服人员离线）

                    //embedded_svc.settings.loadingText = ''; //（默认设置为正在加载）
                    //embedded_svc.settings.storageDomain = 'yourdomain.com'; //（为部署设置域，这样访客可在聊天会话期间导航子域。）

                    // 聊天 的设置
                    //embedded_svc.settings.directToButtonRouting = function(prechatFormData) {
                        // Dynamically changes the button ID based on what the visitor enters in the pre-chat form.
                        // Returns a valid button ID.
                    //};
                    //embedded_svc.settings.prepopulatedPrechatFields = {}; //设置自动填充聊天前表单格字段
                    //embedded_svc.settings.fallbackRouting = []; //按钮 ID、用户 ID 或 userId_buttonId 的数组
                    //embedded_svc.settings.offlineSupportMinimizedText = '...'; //（默认设置为联系我们）

                    //设置聊天前联系人字段
                    embedded_svc.settings.extraPrechatInfo = [{
                        "entityName":"Contact",
                        "saveToTranscript":"Contact",
                        "showOnCreate":true,
                        "entityFieldMaps":[
                            {"doCreate":true,
                             "doFind":false,
                             "fieldName":"LastName",
                             "isExactMatch":false,
                             "label":"Last Name"
                            },
                            {"doCreate":true,
                             "doFind":false,
                             "fieldName":"FirstName",
                             "isExactMatch":false,
                             "label":"First Name"
                            },
                            {"doCreate":true,
                             "doFind":true,
                             "fieldName":"ContactKey__c",
                             "isExactMatch":true,
                            "label":"Email"
                            },
                            {"doCreate":true,
                             "doFind":false,
                             "fieldName":"Send_Transcript__c",
                             "isExactMatch":false,
                             "label":"Need the chat transcript?"
                            }
                        ]
                    }];

                    //设置聊天前聊天脚本的自定义字段
                    embedded_svc.settings.extraPrechatFormDetails = [{
                        "label": "PageUrl",
                        "value":  window.location.href,
                        "displayToAgent": true,
                        "transcriptFields": ["PageUrl__c"]
                    },
                    {
                        "label":"First Name", 
                        "transcriptFields": ["First_Name__c"]
                    },
                    {
                        "label":"Last Name", 
                        "transcriptFields": ["Last_Name__c"]
                    },
                    {
                        "label":"Email", 
                        "transcriptFields": ["Email__c"]
                    },
                    {
                        "label":"Need the chat transcript?", 
                        "transcriptFields": ["Email_Transcript__c"]
                    },

                    //请按照以下方式传递餐素
                    {
                        "label":"Source", 
                        "value":  "Web Site",
                        "transcriptFields": ["Source__c"]
                    },
                    {
                        "label":"Source Desc", 
                        "value":  'beta-anker-us',
                        "transcriptFields": ["Source_Desc__c"]
                    },
                    {
                        "label":"Custom Language", 
                        "value":  "EN",
                        "transcriptFields": ["Custom_Language__c"]
                    },
                    {
                        "label":"Brand", 
                        "value":  "anker",
                        "transcriptFields": ["Brand__c"]
                    },
                    {
                        "label":"IsAgent", 
                        "value":  "yes",
                        "transcriptFields": ["IsAgent__c"]

                    }
                    ];

                    embedded_svc.settings.enabledFeatures = ['LiveAgent'];
                    embedded_svc.settings.entryFeature = 'LiveAgent';

                    embedded_svc.init(
                        'https://anker--dev.my.salesforce.com',
                        'https://dev-support-eufylife.cs73.force.com/eufycninternal',
                        gslbBaseURL,
                        '00D6D0000008f1Q',
                        'Anker_EN_Embedded_Service_Deployment',
                        {
                            baseLiveAgentContentURL: 'https://c.la1-c1cs-hnd.salesforceliveagent.com/content',
                            deploymentId: '5726D0000008OXU',
                            buttonId: '5736D0000008Oqs',
                            baseLiveAgentURL: 'https://d.la1-c1cs-hnd.salesforceliveagent.com/chat',
                            eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04I6D0000004CSiUAM_17b6266da62',
                            isOfflineSupportEnabled: false
                        }
                    );
                };

                if (!window.embedded_svc) {
                    var s = document.createElement('script');
                    s.setAttribute('src', 'https://anker--dev.my.salesforce.com/embeddedservice/5.0/esw.min.js');
                    s.onload = function() {
                        initESW(null);
                    };
                    document.body.appendChild(s);
                } else {
                    initESW('https://service.force.com');
                }
            </script>

        </body>
    </html>
