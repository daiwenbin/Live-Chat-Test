<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <title>Eufy Security</title>
  <style type='text/css'>
     /*如果需要更改聊天按钮的样式可以在此处修改*/
     .embeddedServiceHelpButton .helpButton .uiButton {
        background-color: #62cfc5;
        font-family: "Arial", sans-serif;
      }
      .embeddedServiceHelpButton .helpButton .uiButton:focus {
        outline: 1px solid #62cfc5;
      }
      /* 设置全屏 */
      .dockableContainer{
        max-width: calc(100% - 0px) !important;
        height: calc(100%) !important;
        margin: 0 auto !important;
        border-radius: 0 !important;
      }
      .helpButton,.btnClick{
        display: none;
      }
  </style>
</head>

<body>
  <!-- 聊天按钮，使用时可以用自定义的按钮覆盖 -->
  <input type="button" value="Chat" onclick="chatBtnClick()"  class="btnClick" />
</body>

<script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
<script src="https://cdn.bootcdn.net/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type='text/javascript'>
  //获取URL参数
  function GetRequest() {
    var url = location.search; //获取url中"?"符后的字串
    var theRequest = new Object();
    if (url.indexOf("?") != -1) {
      var str = url.substr(1);
      strs = str.split("&");
      for(var i = 0; i < strs.length; i ++) {
        theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
      }
    }
    return theRequest;
  }
  var queryParams = GetRequest();
    if (queryParams.email&&queryParams.name) {
      queryParams.email = decodeURIComponent(queryParams.email)
      queryParams.name = decodeURIComponent(queryParams.name)
    }
	var initESW = function(gslbBaseURL) {
		embedded_svc.settings.displayHelpButton = true; //Or false
		embedded_svc.settings.language = queryParams.lan; //For example, enter 'en' or 'en-US'
    // 设置聊天前信息
    embedded_svc.settings.prepopulatedPrechatFields = {
      FirstName: queryParams.name,
      LastName: "Doe", // 没有这个字段，默认填充Doe
      Email: queryParams.email,
      Subject: "Hello"
    };
		embedded_svc.settings.enabledFeatures = ['LiveAgent'];
		embedded_svc.settings.entryFeature = 'LiveAgent';
		embedded_svc.init(
			'https://anker--dev.my.salesforce.com',
			'https://dev-support-eufylife.cs73.force.com/test1',
			gslbBaseURL,
			'00D6D0000008f1Q',
			'Eufylife_Embedded_Service_For_App_test',
			{
				baseLiveAgentContentURL: 'https://c.la1-c1cs-hnd.salesforceliveagent.com/content',
				deploymentId: '5726D0000008OXU',
				buttonId: '5736D0000008Ohu',
				baseLiveAgentURL: 'https://d.la1-c1cs-hnd.salesforceliveagent.com/chat',
				eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04I6D0000004CRpUAM_17a0e7012e3',
				isOfflineSupportEnabled: false
			}
		);
	};
	if (!window.embedded_svc) {
		var s = document.createElement('script');
		s.setAttribute('src', 'https://anker--dev.my.salesforce.com/embeddedservice/5.0/esw.min.js');
		s.onload = function() {
			initESW(null);
		};
		document.body.appendChild(s);
	} else {
		initESW('https://service.force.com');
	}
  // 处理默认点击登陆
  function login(){
    var timer = setInterval(function () {
      console.log('===+20')
      if ($('.startButton').html()) {
        console.log('===+21')
        $('.startButton').trigger("click");
        clearInterval(timer)
      }
    }, 100)
  }
  //聊天按钮点击事件
  function chatBtnClick() {
        console.log('===+1')
    $(".helpButtonEnabled").trigger("click");
    $(".minimizedContainer").click();
    login();
  }

  $(function(){
    setTimeout(() => {
        console.log('===+0')
      chatBtnClick()
    }, 1000);
  })
</script>
</html>
